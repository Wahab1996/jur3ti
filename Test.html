<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Drug Interaction Checker (RxNorm via Proxy)</title>
<style>
  body { font-family: Arial, sans-serif; margin: 2em; }
  input, button { margin: 0.5em 0; padding: 0.5em; width: 100%; }
  #result { margin-top: 1em; padding: 1em; border: 1px solid #ccc; }
</style>
</head>
<body>

<h2>Drug Interaction Checker</h2>
<p>Enter two drug names (English):</p>

<input type="text" id="drug1" placeholder="First drug name">
<input type="text" id="drug2" placeholder="Second drug name">
<button onclick="checkInteraction()">Check Interaction</button>

<div id="result"></div>

<script>
async function getRxCUI(drugName) {
  const response = await fetch(`https://corsproxy.io/?https://rxnav.nlm.nih.gov/REST/rxcui.json?name=${encodeURIComponent(drugName)}`);
  const data = await response.json();
  return data.idGroup?.rxnormId?.[0];
}

async function checkInteraction() {
  const drug1 = document.getElementById('drug1').value.trim();
  const drug2 = document.getElementById('drug2').value.trim();
  const resultDiv = document.getElementById('result');
  resultDiv.innerHTML = '⏳ Checking...';

  try {
    const rx1 = await getRxCUI(drug1);
    const rx2 = await getRxCUI(drug2);

    if (!rx1 || !rx2) {
      resultDiv.innerHTML = '❌ One or both drug names not found in RxNorm database.';
      return;
    }

    const url = `https://corsproxy.io/?https://rxnav.nlm.nih.gov/REST/interaction/list.json?rxcuis=${rx1}+${rx2}`;
    const response = await fetch(url);
    const data = await response.json();

    const interactions = data.fullInteractionTypeGroup;

    if (!interactions) {
      resultDiv.innerHTML = '✅ No known interactions found.';
      return;
    }

    let output = '<strong>⚠ Interaction(s) found:</strong><ul>';
    interactions.forEach(group => {
      group.fullInteractionType.forEach(type => {
        type.interactionPair.forEach(pair => {
          const drugs = pair.interactionConcept.map(c => c.minConceptItem.name).join(' + ');
          output += `<li><strong>${drugs}</strong>: ${pair.description}</li>`;
        });
      });
    });
    output += '</ul>';
    resultDiv.innerHTML = output;

  } catch (err) {
    console.error(err);
    resultDiv.innerHTML = '⚠ Error connecting to RxNorm API (via proxy).';
  }
}
</script>

</body>
</html>